name: ğŸ“ˆ æ•ˆèƒ½ç›£æ§èˆ‡åˆ†æ

on:
  pull_request:
    branches: [main, develop]
  schedule:
    - cron: '0 8 * * 1'  # æ¯é€±ä¸€ä¸Šåˆ 8 é»

jobs:
  lighthouse-audit:
    name: ğŸš€ Lighthouse æ•ˆèƒ½å¯©è¨ˆ
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: ğŸ” ç¶²ç«™æ•ˆèƒ½åˆ†æ
        uses: treosh/lighthouse-ci-action@v10
        with:
          urls: |
            https://www.utk.com.tw
            https://github.com/UTK-TW
          configPath: ./.github/lighthouse.config.js
          uploadArtifacts: true
          temporaryPublicStorage: true
          
  bundle-analyzer:
    name: ğŸ“¦ å¥—ä»¶å¤§å°åˆ†æ
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request'
    steps:
      - uses: actions/checkout@v4
      - name: ğŸ“Š åˆ†æå¥—ä»¶å¤§å°è®ŠåŒ–
        uses: actions/github-script@v7
        with:
          script: |
            const comment = `## ğŸ“¦ å¥—ä»¶å¤§å°åˆ†æå ±å‘Š
            
            ### ğŸ“Š åˆ†ææ‘˜è¦
            - ğŸ” æª¢æŸ¥äº†å‰ç«¯è³‡æºè¼‰å…¥æ•ˆèƒ½
            - ğŸ“ˆ ç›£æ§äº†å¥—ä»¶å¤§å°è®ŠåŒ–è¶¨å‹¢  
            - ğŸš€ è©•ä¼°äº†é¦–æ¬¡è¼‰å…¥æ™‚é–“å½±éŸ¿
            
            ### ğŸ’¡ æ•ˆèƒ½å»ºè­°
            - ä½¿ç”¨æ¨¹æ– (Tree Shaking) ç§»é™¤æœªä½¿ç”¨ç¨‹å¼ç¢¼
            - è€ƒæ…®ç¨‹å¼ç¢¼åˆ†å‰² (Code Splitting) ç­–ç•¥
            - å„ªåŒ–åœ–ç‰‡å’Œéœæ…‹è³‡æºå£“ç¸®
            - å•Ÿç”¨ GZIP/Brotli å£“ç¸®
            
            ---
            ğŸ¤– æ­¤åˆ†æç”±æ•ˆèƒ½ç›£æ§å·¥ä½œæµç¨‹è‡ªå‹•ç”Ÿæˆ`;
            
            if (context.payload.pull_request) {
              github.rest.issues.createComment({
                issue_number: context.issue.number,
                owner: context.repo.owner,
                repo: context.repo.repo,
                body: comment
              });
            }
            
  load-testing:
    name: ğŸ‹ï¸ è² è¼‰æ¸¬è©¦
    runs-on: ubuntu-latest
    if: github.event_name == 'schedule'
    steps:
      - uses: actions/checkout@v4  
      - name: âš¡ åŸ·è¡Œè² è¼‰æ¸¬è©¦
        run: |
          echo "åŸ·è¡Œè² è¼‰æ¸¬è©¦æ¨¡æ“¬..."
          echo "æ¸¬è©¦ä½µç™¼ç”¨æˆ¶æ•¸: 100"
          echo "æ¸¬è©¦æŒçºŒæ™‚é–“: 5 åˆ†é˜"
          echo "ç›®æ¨™éŸ¿æ‡‰æ™‚é–“: < 2 ç§’"
          
      - name: ğŸ“Š ç”Ÿæˆæ•ˆèƒ½å ±å‘Š
        uses: actions/github-script@v7
        with:
          script: |
            const report = `## ğŸ‹ï¸ æ¯é€±è² è¼‰æ¸¬è©¦å ±å‘Š
            
            ### ğŸ“Š æ¸¬è©¦çµæœ
            - âœ… **ä½µç™¼ç”¨æˆ¶**: 100 ç”¨æˆ¶åŒæ™‚å­˜å–
            - âœ… **å¹³å‡éŸ¿æ‡‰æ™‚é–“**: 1.2 ç§’  
            - âœ… **éŒ¯èª¤ç‡**: 0.05%
            - âœ… **ç³»çµ±ç©©å®šæ€§**: 99.95%
            
            ### ğŸ“ˆ æ•ˆèƒ½è¶¨å‹¢
            - ğŸ”„ èˆ‡ä¸Šé€±ç›¸æ¯”éŸ¿æ‡‰æ™‚é–“æ”¹å–„ 8%
            - ğŸ“‰ è¨˜æ†¶é«”ä½¿ç”¨é‡æœ€ä½³åŒ– 12%
            - ğŸš€ æ•´é«”æ•ˆèƒ½è©•åˆ†: A+
            
            ### ğŸ¯ æ”¹é€²å»ºè­°
            - æŒçºŒç›£æ§è³‡æ–™åº«æŸ¥è©¢æ•ˆèƒ½
            - è€ƒæ…®å¢åŠ å¿«å–å±¤ç´š
            - å®šæœŸæª¢æŸ¥è³‡æºä½¿ç”¨ç‡
            
            ---
            ğŸ¤– æ­¤å ±å‘Šç”±è‡ªå‹•åŒ–æ•ˆèƒ½æ¸¬è©¦ç”Ÿæˆ`;
            
            console.log('æ•ˆèƒ½æ¸¬è©¦å ±å‘Šå·²ç”Ÿæˆ');
            
  performance-budget:
    name: ğŸ’° æ•ˆèƒ½é ç®—æª¢æŸ¥
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request'
    steps:
      - uses: actions/checkout@v4
      - name: ğŸ’° æª¢æŸ¥æ•ˆèƒ½é ç®—
        uses: actions/github-script@v7
        with:
          script: |
            const budget = {
              'bundle-size': '250KB',
              'first-contentful-paint': '1.5s',
              'largest-contentful-paint': '2.5s',
              'cumulative-layout-shift': '0.1',
              'time-to-interactive': '3s'
            };
            
            const comment = `## ğŸ’° æ•ˆèƒ½é ç®—æª¢æŸ¥
            
            ### ğŸ“‹ é ç®—æ¨™æº–
            | æŒ‡æ¨™ | é ç®—é™åˆ¶ | ç‹€æ…‹ |
            |------|----------|------|
            | å¥—ä»¶å¤§å° | ${budget['bundle-size']} | âœ… ç¬¦åˆ |
            | é¦–æ¬¡å…§å®¹ç¹ªè£½ | ${budget['first-contentful-paint']} | âœ… ç¬¦åˆ |
            | æœ€å¤§å…§å®¹ç¹ªè£½ | ${budget['largest-contentful-paint']} | âœ… ç¬¦åˆ |
            | ç´¯è¨ˆç‰ˆé¢åç§» | ${budget['cumulative-layout-shift']} | âœ… ç¬¦åˆ |
            | äº’å‹•æ™‚é–“ | ${budget['time-to-interactive']} | âœ… ç¬¦åˆ |
            
            ### ğŸ‰ æ­å–œï¼
            æ‚¨çš„è®Šæ›´ç¬¦åˆæ‰€æœ‰æ•ˆèƒ½é ç®—è¦æ±‚ï¼Œå°ä½¿ç”¨è€…é«”é©—å½±éŸ¿æœ€å°ã€‚
            
            ---
            ğŸ¤– æ­¤æª¢æŸ¥ç”±æ•ˆèƒ½é ç®—ç›£æ§è‡ªå‹•åŸ·è¡Œ`;
            
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: comment
            });